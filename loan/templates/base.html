{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Loan Management System</title>
        <link rel="icon" href="{% static 'logo_and_favicon.ico' %}" type="image/x-icon">
        <link rel="shortcut icon" href="{% static 'logo_and_favicon.ico' %}" type="image/x-icon">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <link rel="stylesheet" href="{% static 'base.css' %}">
        <style>
            body {
                background: linear-gradient(180deg, #f1f5ff 0%, #ffffff 60%);
                min-height: 100vh;
                font-size: 16px;
                animation: fadeIn 0.6s ease-out;
            }
            .form-control::placeholder {
                color: rgba(15, 23, 42, 0.4);
                opacity: 1;
            }
            .app-shell {
                padding: 0 1rem 2rem;
            }
            .card-panel {
                background: #fff;
                border-radius: 1.25rem;
                box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
                padding: 1.75rem 1.25rem;
                margin-bottom: 2rem;
                transition: transform 0.25s ease, box-shadow 0.25s ease;
            }
            .card-panel:hover {
                transform: translateY(-4px);
                box-shadow: 0 16px 32px rgba(15, 23, 42, 0.12);
            }
            .toast-container {
                position: fixed;
                top: 1rem;
                right: 1rem;
                z-index: 2000;
            }
            .text-bg-error {
                background-color: #dc3545 !important;
                color: #fff !important;
            }
            .timeline {
                position: relative;
                padding-left: 1.5rem;
            }
            .timeline::before {
                content: '';
                position: absolute;
                top: 0;
                bottom: 0;
                left: 10px;
                width: 2px;
                background: #e2e8f0;
            }
            .timeline-item {
                position: relative;
                padding-left: 1rem;
                margin-bottom: 1.25rem;
            }
            .timeline-point {
                position: absolute;
                left: -2px;
                top: 0.6rem;
                width: 0.65rem;
                height: 0.65rem;
                border-radius: 999px;
                border: 2px solid #fff;
                box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.08);
            }
            .navbar-brand-image {
                width: 42px;
                height: 42px;
                object-fit: contain;
                margin-right: 0.6rem;
            }
            .navbar {
                border-bottom-left-radius: 1rem;
                border-bottom-right-radius: 1rem;
                padding: 0.6rem 1rem;
                transition: transform 260ms ease, box-shadow 260ms ease;
            }
            .site-navbar {
                background: #ffffff;
                position: relative;
                border-top: 3px solid #1976d2; /* thin brand top border */
                box-shadow: 0 6px 24px rgba(6,24,60,0.06);
            }
            /* thick left brand accent */
            .site-navbar::before {
                content: '';
                position: absolute;
                left: 0; top: 0; bottom: 0;
                width: 8px;
                background: linear-gradient(180deg,#1976d2,#00bcd4);
                border-bottom-right-radius: 8px;
            }
            .nav-link {
                font-weight: 600;
                color: #0a2540 !important;
                padding: 0.45rem 0.7rem;
                border-radius: 0.6rem;
            }
            .nav-link:hover {
                background: rgba(25,118,210,0.06);
                color: #0a2540 !important;
                transform: translateY(-1px);
            }
            .brand-gradient {
                color: #1976d2; font-weight:900; letter-spacing:-0.4px; font-size:1.05rem;
            }
            .navbar-search {
                min-width: 320px; max-width:520px; border-radius: 999px; padding: 0.28rem 0.6rem; border: 1px solid rgba(25,118,210,0.12);
                background: #fff; color: #0a2540; transition: box-shadow 160ms ease, transform 160ms ease;
            }
            .navbar-search .form-control { color: #0a2540; }
            .navbar-search:focus-within { box-shadow: 0 10px 36px rgba(25,118,210,0.08); transform: translateY(-2px); }
            .btn-cta-apply {
                background: linear-gradient(90deg,#1976d2,#00bcd4); color: #fff; font-weight:800; border-radius: 999px; padding: 0.56rem 1.1rem; box-shadow: 0 10px 30px rgba(25,118,210,0.12); border:none;
            }
            .btn-cta-apply:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 18px 40px rgba(25,118,210,0.16); }
            /* brand-colored hamburger icon */
            .navbar-toggler-icon {
                background-image: url("data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3E%3Cpath stroke='none' fill='%231976d2' d='M4 7h22v2H4zM4 14h22v2H4zM4 21h22v2H4z'/%3E%3C/svg%3E");
                background-size: 24px 24px;
                background-position: center;
                background-repeat: no-repeat;
            }
            @media (min-width: 992px) {
                .app-shell {
                    max-width: 480px;
                    margin: 0 auto;
                }
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(8px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        </style>
        {% block extra_head %}{% endblock %}
</head>
<body>
    {% if messages %}
        <div class="toast-container">
            {% for message in messages %}
                <div class="toast align-items-center text-bg-{{ message.tags|default:'primary' }} border-0 shadow" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="4000">
                    <div class="d-flex">
                        <div class="toast-body">{{ message }}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
        <nav class="navbar navbar-expand-lg navbar-dark site-navbar mb-4">
            <div class="container-fluid">
                <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}">
                    <img src="{% static 'logo_and_favicon.png' %}" alt="Loan system logo" class="navbar-brand-image" />
                    <span class="brand-gradient">3rd Gen Loans</span>
                </a>
                <form class="d-none d-md-flex mx-auto navbar-search" role="search" onsubmit="event.preventDefault();">
                    <input class="form-control border-0 bg-transparent text-white" placeholder="Search loans, help, FAQs..." aria-label="Search">
                </form>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        {% if user.is_authenticated %}
                            <li class="nav-item"><a class="nav-link" href="{% url 'loan_dashboard' %}">Dashboard</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'loan_application' %}">Apply</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'profile_complete' %}">Profile</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'bank_detail' %}">Bank</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'withdrawal_request' %}">Withdraw</a></li>
                            <li class="nav-item d-none d-lg-block"><a class="nav-link btn-cta-apply" href="{% url 'loan_application' %}">Apply Now</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
                        {% else %}
                            <li class="nav-item"><a class="nav-link" href="{% url 'register' %}">Register</a></li>
                            <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Sign in</a></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>
        <div class="app-shell">
            {% block content_wrapper_start %}
            <div class="card-panel">
            {% endblock %}

                {% block content %}{% endblock %}

            {% block content_wrapper_end %}
            </div>
            {% endblock %}
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var toastElList = [].slice.call(document.querySelectorAll('.toast'));
                toastElList.forEach(function (toastEl) {
                    var toast = new bootstrap.Toast(toastEl);
                    toast.show();
                });
            });
        </script>
                <!-- Desktop-only blocking overlay: mobile-only site enforced (no continue) -->
                <div id="desktop-warning" class="d-none" role="alert" aria-live="assertive">
                    <div class="dw-backdrop" aria-hidden="true"></div>
                    <div class="dw-panel" role="document">
                        <h2 id="dw-title">Mobile only</h2>
                        <p id="dw-desc">This site is available on mobile devices only. Please open this URL on your phone to continue.</p>
                        <div class="mt-3 d-flex align-items-center gap-3">
                            <div>
                                <p class="small text-muted mb-1">Scan to open on your phone</p>
                                <img id="dw-qr" alt="QR code to open on mobile" style="width:120px;height:120px;border-radius:8px;border:1px solid #eef2ff;" src="" />
                            </div>
                            <div class="flex-grow-1">
                                <p class="small text-muted">If you don't have a phone, contact support for help accessing your account.</p>
                            </div>
                        </div>
                    </div>
                    <style>
                        #desktop-warning { position:fixed; inset:0; z-index:3000; display:flex; align-items:center; justify-content:center; }
                        #desktop-warning .dw-backdrop { position:absolute; inset:0; background:rgba(7,12,20,0.65); backdrop-filter: blur(6px); }
                        #desktop-warning .dw-panel { position:relative; z-index:1; background:#fff; padding:1.25rem; border-radius:12px; max-width:720px; width:92%; box-shadow:0 30px 80px rgba(2,6,23,0.28); }
                        #desktop-warning .dw-panel h2 { margin:0 0 .25rem 0; font-size:1.35rem; }
                        #desktop-warning .dw-panel p { margin:0; color:#6b7280; }
                        @media (max-width:576px){ #desktop-warning { display:none !important; } }
                        /* prevent interaction with page when shown */
                        body.desktop-blocked *:not(#desktop-warning):not(#desktop-warning *) { pointer-events: none !important; }
                    </style>
                    <script>
                        (function(){
                            document.addEventListener('DOMContentLoaded', function(){
                                try {
                                    const minDesktop = 768; // widths >= this considered desktop
                                    if (window.innerWidth < minDesktop) return; // mobile - do nothing

                                    var root = document.getElementById('desktop-warning');
                                    if (!root) return;
                                    // show overlay and prevent page interaction
                                    root.classList.remove('d-none');
                                    document.documentElement.classList.add('desktop-blocked');
                                    document.body.style.overflow = 'hidden';

                                    // generate a QR code image that encodes the current URL (uses qrserver free API)
                                    var qr = document.getElementById('dw-qr');
                                    if (qr) {
                                        var url = window.location.href;
                                        var src = 'https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=' + encodeURIComponent(url);
                                        qr.src = src;
                                    }
                                } catch (e){ console.warn('desktop block init failed', e); }
                            });
                        })();
                    </script>
                </div>
        {% block extra_scripts %}{% endblock %}
</body>
</html>
